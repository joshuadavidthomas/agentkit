schema_version: 1
id: devtools.noblock
name: Block Non-Interactive Dev Servers
version: 1.0.0

description: |
  Prevents agents from running blocking dev server commands.

keywords:
  - npm
  - pnpm
  - bun
  - python
  - uv
  - manage.py
  - vite
  - docker
  - cargo
  - just

destructive_patterns:
  - name: node-dev-scripts
    pattern: \b(npm|pnpm|bun)\s+(run\s+)?(dev|start|serve)\b
    severity: high
    description: Blocking dev server
    explanation: |
      Ask the user if the dev server is already running.
      If not, offer to run it in a tmux session.

  - name: vite-dev
    pattern: \bvite\s*(dev|serve)?\s*$
    severity: high
    description: Blocking Vite server
    explanation: |
      Ask the user if the dev server is already running.
      If not, offer to run it in a tmux session.

  - name: django-runserver
    pattern: (python|uv\s+run).*manage\.py\s+runserver
    severity: high
    description: Blocking Django server
    explanation: |
      Ask the user if the dev server is already running.
      If not, offer to run it in a tmux session.

  - name: docker-compose-up-attached
    pattern: \bdocker\s+compose\s+up\b(?!.*-d)
    severity: high
    description: Blocking docker compose
    explanation: |
      Ask the user if containers are already running.
      If not, use "docker compose up -d" for detached mode,
      or offer to run in a tmux session.

  - name: cargo-watch
    pattern: \bcargo\s+(watch|run\s+--watch)
    severity: high
    description: Blocking Cargo watch
    explanation: |
      Ask the user if cargo watch is already running.
      If not, offer to run it in a tmux session.

  - name: just-up-attached
    pattern: \bjust\s+(up|docker\s+up)\b(?!.*-d)
    severity: high
    description: Blocking docker compose via just
    explanation: |
      Ask the user if containers are already running.
      If not, use "just start" for detached mode,
      or offer to run in a tmux session.

  - name: just-tail-logs
    pattern: \bjust\s+(tail|docker\s+tail|logs|docker\s+logs)\b
    severity: high
    description: Blocking log follow
    explanation: |
      Ask the user if they need logs.
      If so, offer to run in a tmux session.

  - name: just-docs-serve
    pattern: \bjust\s+docs\s+serve\b
    severity: high
    description: Blocking docs server
    explanation: |
      Ask the user if the docs server is already running.
      If not, offer to run it in a tmux session.

safe_patterns:
  - name: docker-compose-detached
    pattern: \bdocker\s+compose\s+up\s+.*-d
    description: Detached mode is fine

  - name: just-start
    pattern: \bjust\s+(start|docker\s+start)\b
    description: Starts detached
